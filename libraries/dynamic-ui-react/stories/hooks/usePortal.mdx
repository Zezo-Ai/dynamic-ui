import {
  Meta,
  Canvas,
} from '@storybook/blocks';

import {
  ExamplePortalRoot,
} from './usePortalExamples';

# Portal

With portals, you can render modals, dialogs, overlays and offcanvas menus 
existing outside the DOM hierarchy of the parent component.

To achieve this behavior is necessary to use the `DContextProvider` and the `useDPortalContext` hook.

This part of the documentation talks about portals and directly covers 
its behavior over modals and offcanvas components.

> To achieve inline use of a modal or offcanvas, review the topic in components.

<Meta title="Design System/Patterns/Portal" />

<br/>

## Portal Types `types.ts`
Type to define the payload of all the portals, its structure is an object literal
where the key is used for the name of the portal and value for the payload.

```typescript
type PortalPayloads = {
  modalExample: {
    description: string;
  },
  offcanvasExample: {
    title: string;
  }
};
```

## Portal Definition on Modal `ExampleModal.tsx`
```tsx
import {
  DModal,
  DButton,
} from '@dynamic-framework/ui-react';

import type {
  PortalProps,
} from '@dynamic-framework/ui-react';

import type { PortalPayloads } from './types';

function ExampleModal({ closePortal, payload }: PortalProps<PortalPayloads['modalExample']>) {
  return (
    <DModal
      name="example"
      centered
      staticBackdrop
    >
      <DModal.Header onClose={closePortal} showCloseButton>
        <h5 className="fw-bold">Do you want to reject the offer?</h5>
      </DModal.Header>
      <DModal.Body>
        <p>Modal body</p>
        <small>{payload.description}</small>
      </DModal.Body>
      <DModal.Footer>
        <DButton
          text="cancel"
          theme="secondary"
          variant="outline"
          className="d-grid"
          pill
          onClick={() => closePortal()}
        />
        <DButton 
          text="ok" 
          className="d-grid" 
          pill 
        />
      </DModal.Footer>
    </DModal>
  );
}
```

## Portal Setting on the main file `App.tsx`
The available portals are configured on the `DContextProvider` so that they can
then be opened with the `useDPortalContext` hook. The payload type of the portals
is only necessary if payload will be used.

```tsx
import {
  DContextProvider,
} from '@dynamic-framework/ui-react';

import ExampleModal from './ExampleModal';
import ExamplePortalUsage from './ExampleModalUsage';

import type { PortalPayloads } from './types';

function App() {
  return (
    <DContextProvider<PortalPayloads>
      portalName="portalDOMId"
      availablePortals={{
        example: ExampleModal,
      }}
    >
      <ExamplePortalUsage />
    </DContextProvider>
  );
}
```

## Portal Usage `ExamplePortalUsage.tsx`
```tsx
import {
  DButton,
  useDPortalContext,
} from '@dynamic-framework/ui-react';

import type { PortalPayloads } from './types';

function ExamplePortalUsage() {
  const { openPortal } = useDPortalContext<PortalPayloads>();
  return (
    <DButton
      text="Open Modal"
      onClick={() => openPortal('example', { description: 'from portal payload' })}
    />
  );
}
```

<Canvas>
  <div className="d-flex flex-colum justify-content-end align-items-end">
    <ExamplePortalRoot />
  </div>
</Canvas>
